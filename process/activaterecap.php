<?php
/*
 *  Copyright (C) 2018 Laksamadi Guko.
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
session_start();
// hide all error
error_reporting(0);

// Active Recap Report Data
$reportThisMid = $_GET['reportThisMid'];
$incomeLastM = $_GET['incomeLastM'];
$incomeThisM = $_GET['incomeThisM'];
$lastM = "-|-".date('M',strtotime("-1 month"))."-|-";
$thisdate = date("M/d/Y");

$sourceRRP = ':\if ([/system clock get date]~\"/01/\") do={:local tgl [/system clock get d\ate];:local bl [:pick \$tgl 0 3];if (\$bl = \"jan\") do={:set \$bl \"Dec\"\;:local pend [/system script get ReportPendapatan source];:local pendBul [\/system script get RekapPendapatan source];:local nmBul [/system script ge\t RekapPendapatan comment];:local toPB (\"\$pendBul\" .\",\". \"\$pend\");\:local toPBc (\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\");[/system script set\\_comment=\"\$toPBc\" RekapPendapatan];[/system script set source=\"\$toPB\\" RekapPendapatan];[/system script set source=\"0\" ReportPendapatan];[/s\ystem sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPen\dapatan];[/undo]} else={if (\$bl = \"feb\") do={:set \$bl \"Jan\";:local p\end [/system script get ReportPendapatan source];[/system script set comme\nt=\"-|-Jan-|-\" RekapPendapatan];[/system script set source=\"\$pend\" Re\kapPendapatan];[/system script set source=\"0\" ReportPendapatan];[/system\\_sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapa\tan];[/undo]} else={if (\$bl = \"mar\") do={:set \$bl \"Feb\";:local pend \[/system script get ReportPendapatan source];:local pendBul [/system scrip\t get RekapPendapatan source];:local nmBul [/system script get RekapPendap\atan comment];:local toPB (\"\$pendBul\" .\",\". \"\$pend\");:local toPBc \(\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\");[/system script set comment=\"\$\toPBc\" RekapPendapatan];[/system script set source=\"\$toPB\" RekapPendap\atan];[/system script set source=\"0\" ReportPendapatan];[/system sch re R\esetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/und\o]} else={if (\$bl = \"apr\") do={:set \$bl \"Mar\";:local pend [/system s\cript get ReportPendapatan source];:local pendBul [/system script get Reka\pPendapatan source];:local nmBul [/system script get RekapPendapatan comme\nt];:local toPB (\"\$pendBul\" .\",\". \"\$pend\");:local toPBc (\"\$nmBul\\" .\",-|-\". \"\$bl\".\"-|-\");[/system script set comment=\"\$toPBc\" Re\kapPendapatan];[/system script set source=\"\$toPB\" RekapPendapatan];[/sy\stem script set source=\"0\" ReportPendapatan];[/system sch re ResetReport\Pendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={\if (\$bl = \"may\") do={:set \$bl \"Apr\";:local pend [/system script get \ReportPendapatan source];:local pendBul [/system script get RekapPendapata\n source];:local nmBul [/system script get RekapPendapatan comment];:local\\_toPB (\"\$pendBul\" .\",\". \"\$pend\");:local toPBc (\"\$nmBul\" .\",-|\-\". \"\$bl\".\"-|-\");[/system script set comment=\"\$toPBc\" RekapPendap\atan];[/system script set source=\"\$toPB\" RekapPendapatan];[/system scri\pt set source=\"0\" ReportPendapatan];[/system sch re ResetReportPendapata\n];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if (\$bl \= \"jun\") do={:set \$bl \"May\";:local pend [/system script get ReportPen\dapatan source];:local pendBul [/system script get RekapPendapatan source]\;:local nmBul [/system script get RekapPendapatan comment];:local toPB (\"\\$pendBul\" .\",\". \"\$pend\");:local toPBc (\"\$nmBul\" .\",-|-\". \"\$b\l\".\"-|-\");[/system script set comment=\"\$toPBc\" RekapPendapatan];[/sy\stem script set source=\"\$toPB\" RekapPendapatan];[/system script set sou\rce=\"0\" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo]\;[/system scr re ResetReportPendapatan];[/undo]} else={if (\$bl = \"jul\")\\_do={:set \$bl \"Jun\";:local pend [/system script get ReportPendapatan s\ource];:local pendBul [/system script get RekapPendapatan source];:local n\mBul [/system script get RekapPendapatan comment];:local toPB (\"\$pendBul\\" .\",\". \"\$pend\");:local toPBc (\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\\");[/system script set comment=\"\$toPBc\" RekapPendapatan];[/system scri\pt set source=\"\$toPB\" RekapPendapatan];[/system script set source=\"0\"\\_ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/syste\m scr re ResetReportPendapatan];[/undo]} else={if (\$bl = \"aug\") do={:se\t \$bl \"Jul\";:local pend [/system script get ReportPendapatan source];:l\ocal pendBul [/system script get RekapPendapatan source];:local nmBul [/sy\stem script get RekapPendapatan comment];:local toPB (\"\$pendBul\" .\",\"\. \"\$pend\");:local toPBc (\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\");[/sys\tem script set comment=\"\$toPBc\" RekapPendapatan];[/system script set so\urce=\"\$toPB\" RekapPendapatan];[/system script set source=\"0\" ReportPe\ndapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re R\esetReportPendapatan];[/undo]} else={if (\$bl = \"sep\") do={:set \$bl \"A\ug\";:local pend [/system script get ReportPendapatan source];:local pendB\ul [/system script get RekapPendapatan source];:local nmBul [/system scrip\t get RekapPendapatan comment];:local toPB (\"\$pendBul\" .\",\". \"\$pend\\");:local toPBc (\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\");[/system script\\_set comment=\"\$toPBc\" RekapPendapatan];[/system script set source=\"\$\toPB\" RekapPendapatan];[/system script set source=\"0\" ReportPendapatan]\;[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetRepor\tPendapatan];[/undo]} else={if (\$bl = \"Oct\") do={:set \$bl \"Sep\";:loc\al pend [/system script get ReportPendapatan source];:local pendBul [/syst\em script get RekapPendapatan source];:local nmBul [/system script get Rek\apPendapatan comment];:local toPB (\"\$pendBul\" .\",\". \"\$pend\");:loca\l toPBc (\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\");[/system script set comm\ent=\"\$toPBc\" RekapPendapatan];[/system script set source=\"\$toPB\" Rek\apPendapatan];[/system script set source=\"0\" ReportPendapatan];[/system \sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapata\n];[/undo]} else={if (\$bl = \"nov\") do={:set \$bl \"Oct\";:local pend [/\system script get ReportPendapatan source];:local pendBul [/system script \get RekapPendapatan source];:local nmBul [/system script get RekapPendapat\an comment];:local toPB (\"\$pendBul\" .\",\". \"\$pend\");:local toPBc (\\"\$nmBul\" .\",-|-\". \"\$bl\".\"-|-\");[/system script set comment=\"\$t\oPBc\" RekapPendapatan];[/system script set source=\"\$toPB\" RekapPendapa\tan];[/system script set source=\"0\" ReportPendapatan];[/system sch re Re\setReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo\]} else={if (\$bl = \"dec\") do={:set \$bl \"Nov\";:local pend [/system sc\ript get ReportPendapatan source];:local pendBul [/system script get Rekap\Pendapatan source];:local nmBul [/system script get RekapPendapatan commen\t];:local toPB (\"\$pendBul\" .\",\". \"\$pend\");:local toPBc (\"\$nmBul\\" .\",-|-\". \"\$bl\".\"-|-\");[/system script set comment=\"\$toPBc\" Re\kapPendapatan];[/system script set source=\"\$toPB\" RekapPendapatan];[/sy\stem script set source=\"0\" ReportPendapatan];[/system sch re ResetReport\Pendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]}}}}}}}}\}}}}}';
$sourceRRP = ':if ([/system clock get date]~"/01/") do={:local tgl [/system clock get date];:local bl [:pick $tgl 0 3];if ($bl = "jan") do={:set $bl "Dec";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "feb") do={:set $bl "Jan";:local pend [/system script get ReportPendapatan source];[/system script set comment="-|-Jan-|-" RekapPendapatan];[/system script set source="$pend" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "mar") do={:set $bl "Feb";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "apr") do={:set $bl "Mar";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "may") do={:set $bl "Apr";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "jun") do={:set $bl "May";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "jul") do={:set $bl "Jun";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "aug") do={:set $bl "Jul";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "sep") do={:set $bl "Aug";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "Oct") do={:set $bl "Sep";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "nov") do={:set $bl "Oct";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]} else={if ($bl = "dec") do={:set $bl "Nov";:local pend [/system script get ReportPendapatan source];:local pendBul [/system script get RekapPendapatan source];:local nmBul [/system script get RekapPendapatan comment];:local toPB ("$pendBul" .",". "$pend");:local toPBc ("$nmBul" .",-|-". "$bl"."-|-");[/system script set comment="$toPBc" RekapPendapatan];[/system script set source="$toPB" RekapPendapatan];[/system script set source="0" ReportPendapatan];[/system sch re ResetReportPendapatan];[/undo];[/system scr re ResetReportPendapatan];[/undo]}}}}}}}}}}}}}';

if($report == "activate-recap"){
	$API->comm("/system/script/add", array(
		"name" => "RekapPendapatan",
		"source" => "$incomeLastM",
		"comment" => "$lastM"
	));

	$API->comm("/system/script/add", array(
		"name" => "ReportPendapatan",
		"source" => "$incomeThisM",
		"comment" => "Report Pendapatan"
	));

	$API->comm("/system/script/add", array(
		"name" => "ResetReportPendapatan",
		"source" => "$sourceRRP",
		"comment" => "Reset Report Pendapatan"
	));

	$API->comm("/system/scheduler/add", array(
		"name" => "ResetReportPendapatan",
		"on-event" => "ResetReportPendapatan",
		"start-date" => "$thisdate",
		"start-time" => "00:00:01",
		"interval" => "1d",
		"comment" => "Reset Report Pendapatan"
	));
	
	echo "<script>window.location='./?report=selling&idbl=" . strtolower(date("M")) . date("Y") . "&session=".$session."'</script>";

}elseif($report == "revision-recap"){

	$API->comm("/system/script/set", array(
		".id" => "$reportThisMid",
		"name" => "ReportPendapatan",
		"source" => "$incomeThisM",
		"comment" => "Report Pendapatan"
	));

	echo "<script>window.location='./?report=selling&idbl=" . strtolower(date("M")) . date("Y") . "&session=".$session."'</script>";
}

?>